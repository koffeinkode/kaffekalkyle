<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaffekalkulator</title>
    <style>
        .coffee-calculator-wrapper {
            all: initial;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            font-size: 16px;
            line-height: 1.5;
            color: #2d3748;
            display: block;
            width: 100%;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f7fafc;
            border-radius: 12px;
            box-sizing: border-box;
        }
        
        .coffee-calculator-wrapper *,
        .coffee-calculator-wrapper *::before,
        .coffee-calculator-wrapper *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        .coffee-calculator-wrapper .container {
            background-color: white;
            padding: 32px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            width: 100%;
        }
        
        .coffee-calculator-wrapper h1 {
            color: #1a202c;
            text-align: center;
            margin-bottom: 32px;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: -0.025em;
        }
        
        .coffee-calculator-wrapper .subtitle {
            text-align: center;
            color: #718096;
            font-size: 16px;
            margin-bottom: 32px;
            font-weight: 500;
        }
        
        .coffee-calculator-wrapper .key-info {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .coffee-calculator-wrapper .info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            transition: transform 0.2s;
            opacity: 0.8;
        }
        
        .coffee-calculator-wrapper .info-card:hover {
            transform: translateY(-2px);
        }
        
        .coffee-calculator-wrapper .info-label {
            font-size: 11px;
            opacity: 0.9;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            font-weight: 600;
        }
        
        .coffee-calculator-wrapper .info-value {
            font-size: 16px;
            font-weight: 700;
            letter-spacing: -0.025em;
        }
        
        .coffee-calculator-wrapper .input-section {
            background-color: #f7fafc;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 32px;
            border: 1px solid #e2e8f0;
        }
        
        .coffee-calculator-wrapper .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
        }
        
        .coffee-calculator-wrapper .input-group {
            margin-bottom: 20px;
        }
        
        .coffee-calculator-wrapper label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #4a5568;
            font-size: 14px;
        }
        
        .coffee-calculator-wrapper input {
            width: 100% !important;
            padding: 12px !important;
            border: 2px solid #e2e8f0 !important;
            border-radius: 8px !important;
            font-size: 16px !important;
            box-sizing: border-box !important;
            font-family: inherit !important;
            background-color: white !important;
            color: #2d3748 !important;
            transition: border-color 0.2s, box-shadow 0.2s !important;
            outline: none !important;
        }
        
        .coffee-calculator-wrapper input:focus {
            border-color: #667eea !important;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1) !important;
        }
        
        .coffee-calculator-wrapper .coffee-display {
            background: linear-gradient(135deg, #f0fff4 0%, #f7fafc 100%);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 32px;
            border: 1px solid #e2e8f0;
        }
        
        .coffee-calculator-wrapper .coffee-name {
            font-weight: 700;
            color: #1a202c;
            font-size: 18px;
            margin-bottom: 12px;
        }
        
        .coffee-calculator-wrapper .coffee-price {
            font-size: 14px;
            color: #718096;
            margin-bottom: 8px;
        }
        
        .coffee-calculator-wrapper .roasted-price {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
            background: white;
            padding: 8px 12px;
            border-radius: 8px;
            display: inline-block;
        }
        
        .coffee-calculator-wrapper .results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-top: 32px;
        }
        
        .coffee-calculator-wrapper .result-card {
            background-color: white;
            padding: 24px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .coffee-calculator-wrapper .result-title {
            font-size: 20px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f7fafc;
        }
        
        .coffee-calculator-wrapper .cost-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 8px 0;
            font-size: 14px;
            color: #4a5568;
        }
        
        .coffee-calculator-wrapper .cost-item.total {
            border-top: 2px solid #e2e8f0;
            font-weight: 600;
            margin-top: 16px;
            padding-top: 16px;
            color: #1a202c;
            font-size: 16px;
        }
        
        .coffee-calculator-wrapper .profit {
            background: linear-gradient(135deg, #f0fff4 0%, #f7fafc 100%);
            padding: 16px;
            border-radius: 12px;
            margin-top: 16px;
            border: 1px solid #e2e8f0;
        }
        
        .coffee-calculator-wrapper .profit-highlight {
            font-size: 16px;
            font-weight: 600;
            color: #1a202c;
        }
        
        .coffee-calculator-wrapper .salgspris-highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white !important;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 12px 0;
            font-weight: 700;
            font-size: 18px;
        }
        
        .coffee-calculator-wrapper .profit-amount {
            color: #667eea;
            font-weight: 700;
            font-size: 18px;
        }
        
        .coffee-calculator-wrapper h4 {
            color: #1a202c;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 700;
        }
        
        .coffee-calculator-wrapper .pdf-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin: 24px auto 0;
            display: block;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .coffee-calculator-wrapper .pdf-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .coffee-calculator-wrapper .pdf-button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Print styles for PDF */
        @media print {
            .coffee-calculator-wrapper {
                background-color: white !important;
                margin: 0 !important;
                padding: 20px !important;
                box-shadow: none !important;
                border-radius: 0 !important;
            }
            
            .coffee-calculator-wrapper .container {
                box-shadow: none !important;
                padding: 0 !important;
            }
            
            .coffee-calculator-wrapper .input-section {
                display: none !important;
            }
            
            .coffee-calculator-wrapper .pdf-button {
                display: none !important;
            }
            
            .coffee-calculator-wrapper .results {
                break-inside: avoid;
                page-break-inside: avoid;
            }
            
            .coffee-calculator-wrapper .result-card {
                break-inside: avoid;
                page-break-inside: avoid;
                margin-bottom: 20px;
            }
            
            .coffee-calculator-wrapper h1 {
                font-size: 2rem !important;
                margin-bottom: 10px !important;
            }
            
            .coffee-calculator-wrapper .subtitle {
                margin-bottom: 20px !important;
            }
            
            .coffee-calculator-wrapper .key-info {
                margin-bottom: 20px !important;
            }
            
            .coffee-calculator-wrapper .info-card {
                background: #667eea !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            .coffee-calculator-wrapper .salgspris-highlight {
                background: #667eea !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            .coffee-calculator-wrapper .profit {
                background: #f0fff4 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }
        
        @media (max-width: 768px) {
            .coffee-calculator-wrapper {
                margin: 10px;
                padding: 10px;
            }
            .coffee-calculator-wrapper .input-grid, 
            .coffee-calculator-wrapper .results {
                grid-template-columns: 1fr;
            }
            .coffee-calculator-wrapper .key-info {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            /* Responsivt grÃ¸nt felt */
            .coffee-calculator-wrapper .coffee-display > div {
                display: block !important;
                text-align: left !important;
            }
            .coffee-calculator-wrapper .coffee-display > div > div {
                margin-bottom: 8px;
                text-align: left !important;
            }
            .coffee-calculator-wrapper .coffee-display > div > div:last-child {
                text-align: center !important;
                margin-top: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="coffee-calculator-wrapper">
        <div class="container">
            <h1>â˜• Koffeinvinduets kaffekalkulator</h1>
            
            <div class="key-info">
                <div class="info-card">
                    <div class="info-label">RÃ¥varepris brent</div>
                    <div class="info-value" id="rawMaterialPrice">226,06 kr/kg</div>
                </div>
                <div class="info-card">
                    <div class="info-label">Takeaway (60%)</div>
                    <div class="info-value" id="recommendedCupPrice">72,00 kr</div>
                </div>
                <div class="info-card">
                    <div class="info-label">Pose (60%)</div>
                    <div class="info-value" id="recommendedBagPrice">245,00 kr</div>
                </div>
            </div>
            
            <div class="coffee-display">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; align-items: center;">
                    <div>
                        <div class="coffee-name" id="coffeeNameDisplay">Ukjent kaffe</div>
                        <div class="coffee-price">GrÃ¸nn kaffe + frakt + 15% MVA: <span id="greenTotalPrice">197,80 kr/kg</span></div>
                    </div>
                    <div style="text-align: center; font-size: 16px; color: #666;">
                        Etter 12,5% vekttap under brenning:
                    </div>
                    <div style="text-align: right;">
                        <div class="roasted-price" id="roastedPrice">226,06 kr/kg brent kaffe</div>
                    </div>
                </div>
            </div>
        
        <div class="input-section">
            <div class="input-grid">
                <div>
                    <h4 style="color: #8B4513; margin-bottom: 15px;">GrÃ¸nnkaffe</h4>
                    <div class="input-group">
                        <label for="coffeeName">GrÃ¸nnkaffe:</label>
                        <input type="text" id="coffeeName" value="" placeholder="">
                    </div>
                    <div class="input-group">
                        <label for="greenCoffeePrice">Pris per kg grÃ¸nn kaffe (kr):</label>
                        <input type="number" id="greenCoffeePrice" value="172" step="0.01">
                    </div>
                    <div class="input-group">
                        <label for="shippingCost">Frakt per forsendelse (kr):</label>
                        <input type="number" id="shippingCost" value="0" step="0.01" placeholder="Valgfritt">
                    </div>
                    <div class="input-group">
                        <label for="orderQuantity">Bestilt mengde (kg):</label>
                        <input type="number" id="orderQuantity" value="1" step="0.1" placeholder="F.eks. 35 kg">
                    </div>
                </div>
                
                <div>
                    <h4 style="color: #8B4513; margin-bottom: 15px;">LÃ¸nn, forbruksvarer og bryggeoppskrift</h4>
                    <div class="input-group">
                        <label for="hourlyWage">TimelÃ¸nn (kr/time):</label>
                        <input type="number" id="hourlyWage" value="250" step="0.01">
                    </div>
                    <div class="input-group">
                        <label for="employerTax">Arbeidsgiveravgift (%):</label>
                        <input type="number" id="employerTax" value="14.1" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="coffeeGrams">Kaffe per kopp (gram):</label>
                        <input type="number" id="coffeeGrams" value="15" step="0.1" min="10" max="30">
                    </div>
                    <div class="input-group">
                        <label for="brewTime">Bryggingstid (minutter):</label>
                        <input type="number" id="brewTime" value="4" step="0.5" min="1" max="10">
                    </div>
                    <div class="input-group">
                        <label for="cupPrice">Pappkopp + lokk (kr):</label>
                        <input type="number" id="cupPrice" value="0.80" step="0.01">
                    </div>
                    <div class="input-group">
                        <label for="filterPrice">Kaffefilter (kr):</label>
                        <input type="number" id="filterPrice" value="0.80" step="0.01">
                    </div>
                    <div class="input-group">
                        <label for="bagPrice">Pose + etikett (kr):</label>
                        <input type="number" id="bagPrice" value="7.00" step="0.01">
                    </div>
                    <div class="input-group">
                        <label for="bagGrams">Posevekt (g):</label>
                        <input type="number" id="bagGrams" value="250" step="1" min="50" max="500">
                    </div>
                    <div class="input-group">
                        <label for="cupCustomPrice">Salgspris takeaway (kr):</label>
                        <input type="number" id="cupCustomPrice" value="72" step="0.01">
                    </div>
                    <div class="input-group">
                        <label for="bagCustomPrice">Salgspris kaffepose (kr):</label>
                        <input type="number" id="bagCustomPrice" value="245" step="0.01">
                    </div>
                </div>
            </div>
        </div>

        <div class="results">
            <div class="result-card">
                <div class="result-title">Kaffepose (<span id="bagGramsDisplay">250</span>g)</div>
                <div class="cost-item">
                    <span>Brent kaffe (<span id="bagGramsDisplay2">250</span>g):</span>
                    <span id="bagCoffeePrice">56,52 kr</span>
                </div>
                <div class="cost-item">
                    <span>Pose + etikett:</span>
                    <span id="bagCostDisplay">7,00 kr</span>
                </div>
                <div class="cost-item">
                    <span>LÃ¸nn (pakking, 3 min):</span>
                    <span id="bagLabor">14,27 kr</span>
                </div>
                <div class="cost-item">
                    <span>Zettle-gebyr (1,75%):</span>
                    <span id="bagTransaction">4,29 kr</span>
                </div>
                <div class="cost-item">
                    <span>MVA (15%):</span>
                    <span id="bagVAT">36,75 kr</span>
                </div>
                <div class="cost-item total">
                    <span>Totale kostnader:</span>
                    <span id="bagTotalCost">118,83 kr</span>
                </div>
                <div class="profit">
                    <div class="cost-item salgspris-highlight">
                        <span>ðŸ“¦ <strong>Din salgspris:</strong></span>
                        <span id="bagCustomPriceDisplay">245,00 kr</span>
                    </div>
                    <div class="cost-item profit-highlight">
                        <span>Fortjeneste:</span>
                        <span class="profit-amount" id="bagProfit">126,17 kr</span>
                    </div>
                    <div class="cost-item">
                        <span>Margin:</span>
                        <span id="bagActualMargin">62%</span>
                    </div>
                </div>
            </div>

            <div class="result-card">
                <div class="result-title">Takeaway-kaffe (<span id="coffeeGramsDisplay">15</span>g)</div>
                <div class="cost-item">
                    <span>Brent kaffe (<span id="coffeeGramsDisplay2">15</span>g):</span>
                    <span id="cupCoffeePrice">3,39 kr</span>
                </div>
                <div class="cost-item">
                    <span>Papirkopp + lokk:</span>
                    <span id="cupCostDisplay">0,80 kr</span>
                </div>
                <div class="cost-item">
                    <span>Kaffefilter:</span>
                    <span id="filterCostDisplay">0,80 kr</span>
                </div>
                <div class="cost-item">
                    <span>LÃ¸nn (<span id="brewTimeDisplay">4</span> min):</span>
                    <span id="cupLabor">19,02 kr</span>
                </div>
                <div class="cost-item">
                    <span>Zettle-gebyr (1,75%):</span>
                    <span id="cupTransaction">1,26 kr</span>
                </div>
                <div class="cost-item">
                    <span>MVA (15%):</span>
                    <span id="cupVAT">10,80 kr</span>
                </div>
                <div class="cost-item total">
                    <span>Totale kostnader:</span>
                    <span id="cupTotalCost">36,07 kr</span>
                </div>
                <div class="profit">
                    <div class="cost-item salgspris-highlight">
                        <span>â˜• <strong>Din salgspris:</strong></span>
                        <span id="cupCustomPriceDisplay">72,00 kr</span>
                    </div>
                    <div class="cost-item profit-highlight">
                        <span>Fortjeneste:</span>
                        <span class="profit-amount" id="cupProfit">35,93 kr</span>
                    </div>
                    <div class="cost-item">
                        <span>Margin:</span>
                        <span id="cupActualMargin">60%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <button class="pdf-button" onclick="generatePDF()">ðŸ“„ Last ned PDF</button>
    </div>

    <script>
        function calculateAll() {
            console.log('=== CALCULATE ALL START ===');
            
            // Hent alle verdier fra input-feltene
            const coffeeName = document.getElementById('coffeeName').value || 'Ukjent kaffe';
            const greenCoffeePrice = parseFloat(document.getElementById('greenCoffeePrice').value) || 0;
            const shippingCost = parseFloat(document.getElementById('shippingCost').value) || 0;
            const orderQuantity = parseFloat(document.getElementById('orderQuantity').value) || 1;
            const coffeeGrams = parseFloat(document.getElementById('coffeeGrams').value) || 15;
            const brewTime = parseFloat(document.getElementById('brewTime').value) || 4;
            const hourlyWage = parseFloat(document.getElementById('hourlyWage').value) || 250;
            const employerTax = parseFloat(document.getElementById('employerTax').value) || 14.1;
            const cupPrice = parseFloat(document.getElementById('cupPrice').value) || 0;
            const filterPrice = parseFloat(document.getElementById('filterPrice').value) || 0;
            const bagPrice = parseFloat(document.getElementById('bagPrice').value) || 0;
            const bagGrams = parseFloat(document.getElementById('bagGrams').value) || 250;
            const cupCustomPrice = parseFloat(document.getElementById('cupCustomPrice').value) || 72;
            const bagCustomPrice = parseFloat(document.getElementById('bagCustomPrice').value) || 245;
            
            // Beregn grunnleggende priser
            const shippingPerKg = orderQuantity > 0 ? shippingCost / orderQuantity : 0;
            const totalGreenPrice = (greenCoffeePrice + shippingPerKg) * 1.15; // 15% MVA
            const roastedPrice = totalGreenPrice / 0.875; // 12.5% vekttap
            const totalHourlyWage = hourlyWage * (1 + employerTax / 100);
            
            // Oppdater kaffeinformasjon
            document.getElementById('coffeeNameDisplay').textContent = coffeeName;
            document.getElementById('greenTotalPrice').textContent = totalGreenPrice.toFixed(2) + ' kr/kg';
            document.getElementById('roastedPrice').textContent = roastedPrice.toFixed(2) + ' kr/kg brent kaffe';
            
            // Oppdater rÃ¥varepris Ã¸verst
            document.getElementById('rawMaterialPrice').textContent = roastedPrice.toFixed(2) + ' kr/kg';
            
            // Beregn anbefalte priser for 60% margin
            const recommendedCupPrice = calculateRecommendedPrice(roastedPrice, coffeeGrams, brewTime, totalHourlyWage, cupPrice, filterPrice, 0.6);
            const recommendedBagPrice = calculateRecommendedPrice(roastedPrice, bagGrams, 3, totalHourlyWage, bagPrice, 0, 0.6);
            
            // Oppdater anbefalte priser Ã¸verst
            document.getElementById('recommendedCupPrice').textContent = recommendedCupPrice.toFixed(0) + ' kr';
            document.getElementById('recommendedBagPrice').textContent = recommendedBagPrice.toFixed(0) + ' kr';
            
            // Oppdater gram-visninger
            document.getElementById('coffeeGramsDisplay').textContent = coffeeGrams;
            document.getElementById('coffeeGramsDisplay2').textContent = coffeeGrams;
            document.getElementById('brewTimeDisplay').textContent = brewTime;
            document.getElementById('bagGramsDisplay').textContent = bagGrams;
            document.getElementById('bagGramsDisplay2').textContent = bagGrams;
            
            // TAKEAWAY-KAFFE BEREGNINGER med faktiske priser
            const cupCoffeePrice = roastedPrice * (coffeeGrams / 1000);
            const cupLabor = totalHourlyWage * (brewTime / 60);
            const cupTransaction = cupCustomPrice * 0.0175;
            const cupVAT = cupCustomPrice * 0.15;
            const cupDirectCosts = cupCoffeePrice + cupPrice + filterPrice + cupLabor;
            const cupTotalCost = cupDirectCosts + cupTransaction + cupVAT;
            const cupNetIncome = cupCustomPrice - cupTransaction - cupVAT;
            const cupProfit = cupNetIncome - cupDirectCosts;
            const cupActualMargin = cupNetIncome > 0 ? (cupProfit / cupNetIncome) * 100 : 0;
            
            // Oppdater takeaway-visning
            document.getElementById('cupCoffeePrice').textContent = cupCoffeePrice.toFixed(2) + ' kr';
            document.getElementById('cupCostDisplay').textContent = cupPrice.toFixed(2) + ' kr';
            document.getElementById('filterCostDisplay').textContent = filterPrice.toFixed(2) + ' kr';
            document.getElementById('cupLabor').textContent = cupLabor.toFixed(2) + ' kr';
            document.getElementById('cupTransaction').textContent = cupTransaction.toFixed(2) + ' kr';
            document.getElementById('cupVAT').textContent = cupVAT.toFixed(2) + ' kr';
            document.getElementById('cupTotalCost').textContent = cupTotalCost.toFixed(2) + ' kr';
            document.getElementById('cupCustomPriceDisplay').textContent = cupCustomPrice.toFixed(0) + ' kr';
            document.getElementById('cupProfit').textContent = cupProfit.toFixed(2) + ' kr';
            document.getElementById('cupActualMargin').textContent = Math.max(0, cupActualMargin).toFixed(0) + '%';
            
            // KAFFEPOSE BEREGNINGER med faktiske priser
            const bagCoffeePrice = roastedPrice * (bagGrams / 1000);
            const bagLabor = totalHourlyWage * (3/60);
            const bagTransaction = bagCustomPrice * 0.0175;
            const bagVAT = bagCustomPrice * 0.15;
            const bagDirectCosts = bagCoffeePrice + bagPrice + bagLabor;
            const bagTotalCost = bagDirectCosts + bagTransaction + bagVAT;
            const bagNetIncome = bagCustomPrice - bagTransaction - bagVAT;
            const bagProfit = bagNetIncome - bagDirectCosts;
            const bagActualMargin = bagNetIncome > 0 ? (bagProfit / bagNetIncome) * 100 : 0;
            
            // Oppdater kaffepose-visning
            document.getElementById('bagCoffeePrice').textContent = bagCoffeePrice.toFixed(2) + ' kr';
            document.getElementById('bagCostDisplay').textContent = bagPrice.toFixed(2) + ' kr';
            document.getElementById('bagLabor').textContent = bagLabor.toFixed(2) + ' kr';
            document.getElementById('bagTransaction').textContent = bagTransaction.toFixed(2) + ' kr';
            document.getElementById('bagVAT').textContent = bagVAT.toFixed(2) + ' kr';
            document.getElementById('bagTotalCost').textContent = bagTotalCost.toFixed(2) + ' kr';
            document.getElementById('bagCustomPriceDisplay').textContent = bagCustomPrice.toFixed(0) + ' kr';
            document.getElementById('bagProfit').textContent = bagProfit.toFixed(2) + ' kr';
            document.getElementById('bagActualMargin').textContent = Math.max(0, bagActualMargin).toFixed(0) + '%';
            
            console.log('=== CALCULATE ALL END ===');
        }

        function calculateRecommendedPrice(roastedPrice, grams, timeMinutes, totalHourlyWage, packagingCost, filterCost, targetMargin) {
            const coffeePrice = roastedPrice * (grams / 1000);
            const laborCost = totalHourlyWage * (timeMinutes / 60);
            const directCosts = coffeePrice + packagingCost + (filterCost || 0) + laborCost;
            const netIncome = directCosts / (1 - targetMargin);
            const salePrice = netIncome / 0.8325;
            return salePrice;
        }

        function generatePDF() {
            // Sjekk om vi er i en vanlig nettleser eller Platypus-app
            const isInBrowser = window.location.protocol === 'http:' || window.location.protocol === 'https:';
            
            if (!isInBrowser) {
                // Vi er i Platypus-appen
                alert('PDF-funksjon er ikke tilgjengelig i desktop-appen.\n\nFor Ã¥ lage PDF:\n1. Ã…pne denne HTML-filen i Safari\n2. Eller skriv av tallene manuelt\n3. Alle beregninger er synlige pÃ¥ skjermen');
                return;
            }
            
            // Vi er i en vanlig nettleser - lag ekte PDF
            const button = document.querySelector('.pdf-button');
            button.disabled = true;
            button.textContent = 'Genererer PDF...';
            
            try {
                // Samle alle data
                const coffeeName = document.getElementById('coffeeName').value || 'Ukjent kaffe';
                const currentDate = new Date().toLocaleDateString('no-NO');
                const greenCoffeePrice = document.getElementById('greenCoffeePrice').value;
                
                // Hent alle verdier
                const rawMaterialPrice = document.getElementById('rawMaterialPrice').textContent;
                const recommendedCupPrice = document.getElementById('recommendedCupPrice').textContent;
                const recommendedBagPrice = document.getElementById('recommendedBagPrice').textContent;
                
                // Takeaway data
                const cupCoffeePrice = document.getElementById('cupCoffeePrice').textContent;
                const cupCostDisplay = document.getElementById('cupCostDisplay').textContent;
                const filterCostDisplay = document.getElementById('filterCostDisplay').textContent;
                const cupLabor = document.getElementById('cupLabor').textContent;
                const cupTransaction = document.getElementById('cupTransaction').textContent;
                const cupVAT = document.getElementById('cupVAT').textContent;
                const cupTotalCost = document.getElementById('cupTotalCost').textContent;
                const cupCustomPriceDisplay = document.getElementById('cupCustomPriceDisplay').textContent;
                const cupProfit = document.getElementById('cupProfit').textContent;
                const cupActualMargin = document.getElementById('cupActualMargin').textContent;
                const coffeeGrams = document.getElementById('coffeeGrams').value;
                const brewTime = document.getElementById('brewTime').value;
                
                // Kaffepose data
                const bagCoffeePrice = document.getElementById('bagCoffeePrice').textContent;
                const bagCostDisplay = document.getElementById('bagCostDisplay').textContent;
                const bagLabor = document.getElementById('bagLabor').textContent;
                const bagTransaction = document.getElementById('bagTransaction').textContent;
                const bagVAT = document.getElementById('bagVAT').textContent;
                const bagTotalCost = document.getElementById('bagTotalCost').textContent;
                const bagCustomPriceDisplay = document.getElementById('bagCustomPriceDisplay').textContent;
                const bagProfit = document.getElementById('bagProfit').textContent;
                const bagActualMargin = document.getElementById('bagActualMargin').textContent;
                const bagGrams = document.getElementById('bagGrams').value;
                
                // Lag HTML for PDF-vindu
                const pdfHTML = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Koffeinvinduets kaffekalkulator - ${coffeeName}</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: white; 
            color: #333;
            line-height: 1.4;
        }
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 30px; 
            border-radius: 12px; 
            text-align: center; 
            margin-bottom: 30px;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .header h1 { 
            margin: 0; 
            font-size: 28px; 
            font-weight: 700;
        }
        .header p { 
            margin: 10px 0 0 0; 
            opacity: 0.95; 
            font-size: 16px;
        }
        .summary { 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .summary-card { 
            background: #f8fafc; 
            padding: 20px; 
            border-radius: 12px; 
            text-align: center; 
            border: 2px solid #e2e8f0;
        }
        .summary-label { 
            font-size: 12px; 
            color: #666; 
            text-transform: uppercase; 
            margin-bottom: 8px; 
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        .summary-value { 
            font-size: 18px; 
            font-weight: bold; 
            color: #1a202c; 
        }
        .results { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 30px; 
        }
        .result-card { 
            background: white; 
            border: 2px solid #e2e8f0; 
            border-radius: 12px; 
            padding: 25px;
            break-inside: avoid;
        }
        .result-title { 
            font-size: 20px; 
            font-weight: bold; 
            margin-bottom: 20px; 
            color: #1a202c; 
            border-bottom: 2px solid #f7fafc; 
            padding-bottom: 12px; 
        }
        .cost-item { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 10px; 
            font-size: 14px; 
            padding: 4px 0;
        }
        .cost-item.total { 
            border-top: 2px solid #e2e8f0; 
            margin-top: 15px; 
            padding-top: 15px; 
            font-weight: bold; 
            font-size: 16px; 
            color: #1a202c;
        }
        .profit-section { 
            background: linear-gradient(135deg, #f0fff4 0%, #f7fafc 100%); 
            padding: 20px; 
            border-radius: 12px; 
            margin-top: 20px; 
            border: 1px solid #e2e8f0;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .salgspris { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 12px 16px; 
            border-radius: 8px; 
            margin-bottom: 15px; 
            font-weight: bold; 
            font-size: 16px;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .profit-amount { 
            color: #667eea; 
            font-weight: bold; 
            font-size: 16px; 
        }
        .footer { 
            text-align: center; 
            margin-top: 40px; 
            color: #666; 
            font-size: 12px; 
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
        @media print {
            body { margin: 0; padding: 15px; }
            .results { break-inside: avoid; }
            .result-card { break-inside: avoid; margin-bottom: 20px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>â˜• Koffeinvinduets kaffekalkulator</h1>
        <p>Kostnadsanalyse for ${coffeeName} - ${currentDate}</p>
    </div>
    
    <div class="summary">
        <div class="summary-card">
            <div class="summary-label">RÃ¥varepris brent kaffe</div>
            <div class="summary-value">${rawMaterialPrice}</div>
        </div>
        <div class="summary-card">
            <div class="summary-label">Anbefalt takeaway (60%)</div>
            <div class="summary-value">${recommendedCupPrice}</div>
        </div>
        <div class="summary-card">
            <div class="summary-label">Anbefalt pose (60%)</div>
            <div class="summary-value">${recommendedBagPrice}</div>
        </div>
    </div>
    
    <div class="results">
        <div class="result-card">
            <div class="result-title">Takeaway-kaffe (${coffeeGrams}g)</div>
            <div class="cost-item"><span>Brent kaffe (${coffeeGrams}g):</span><span>${cupCoffeePrice}</span></div>
            <div class="cost-item"><span>Papirkopp + lokk:</span><span>${cupCostDisplay}</span></div>
            <div class="cost-item"><span>Kaffefilter:</span><span>${filterCostDisplay}</span></div>
            <div class="cost-item"><span>LÃ¸nn (${brewTime} min):</span><span>${cupLabor}</span></div>
            <div class="cost-item"><span>Zettle-gebyr (1,75%):</span><span>${cupTransaction}</span></div>
            <div class="cost-item"><span>MVA (15%):</span><span>${cupVAT}</span></div>
            <div class="cost-item total"><span>Totale kostnader:</span><span>${cupTotalCost}</span></div>
            
            <div class="profit-section">
                <div class="salgspris">â˜• Din salgspris: ${cupCustomPriceDisplay}</div>
                <div class="cost-item"><span>Fortjeneste:</span><span class="profit-amount">${cupProfit}</span></div>
                <div class="cost-item"><span>Margin:</span><span>${cupActualMargin}</span></div>
            </div>
        </div>
        
        <div class="result-card">
            <div class="result-title">Kaffepose (${bagGrams}g)</div>
            <div class="cost-item"><span>Brent kaffe (${bagGrams}g):</span><span>${bagCoffeePrice}</span></div>
            <div class="cost-item"><span>Pose + etikett:</span><span>${bagCostDisplay}</span></div>
            <div class="cost-item"><span>LÃ¸nn (pakking, 3 min):</span><span>${bagLabor}</span></div>
            <div class="cost-item"><span>Zettle-gebyr (1,75%):</span><span>${bagTransaction}</span></div>
            <div class="cost-item"><span>MVA (15%):</span><span>${bagVAT}</span></div>
            <div class="cost-item total"><span>Totale kostnader:</span><span>${bagTotalCost}</span></div>
            
            <div class="profit-section">
                <div class="salgspris">ðŸ“¦ Din salgspris: ${bagCustomPriceDisplay}</div>
                <div class="cost-item"><span>Fortjeneste:</span><span class="profit-amount">${bagProfit}</span></div>
                <div class="cost-item"><span>Margin:</span><span>${bagActualMargin}</span></div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        Generert av Koffeinvinduets kaffekalkulator - ${currentDate}<br>
        GrÃ¸nnkaffe pris: ${greenCoffeePrice} kr/kg
    </div>
</body>
</html>`;

                // Ã…pne nytt vindu med PDF-innhold
                const pdfWindow = window.open('', '_blank', 'width=1000,height=800');
                pdfWindow.document.write(pdfHTML);
                pdfWindow.document.close();
                
                // Legg til print-funksjonalitet
                pdfWindow.onload = function() {
                    setTimeout(() => {
                        pdfWindow.print();
                    }, 500);
                };
                
            } catch (error) {
                console.error('Feil ved PDF-generering:', error);
                alert('Det oppstod en feil ved PDF-generering. PrÃ¸v igjen.');
            } finally {
                button.disabled = false;
                button.textContent = 'ðŸ“„ Last ned PDF';
            }
        }

        // Set up event listeners when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded - setting up calculator');
            
            const inputIds = [
                'coffeeName', 'greenCoffeePrice', 'shippingCost', 'orderQuantity',
                'coffeeGrams', 'brewTime', 'hourlyWage', 'employerTax',
                'cupPrice', 'filterPrice', 'bagPrice', 'bagGrams',
                'cupCustomPrice', 'bagCustomPrice'
            ];
            
            inputIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', calculateAll);
                    element.addEventListener('change', calculateAll);
                    console.log('Attached listeners to:', id);
                } else {
                    console.error('Could not find element:', id);
                }
            });
            
            // Run initial calculation
            calculateAll();
        });
    </script>
</body>
</html>
